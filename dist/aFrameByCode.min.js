// name: aFrameByCode
// author: Faace Yu
// version: 1.2.4
// github: https://github.com/faace/aFrameByCode

(function(v){AFRAME.$=$=document.querySelector.bind(document);AFRAME.$$=$$=document.querySelectorAll.bind(document);var C=AFRAME.afterAllCallback=function(D,g,F){var E=0;return function(){F&&F(Math.min(D,E+1),D);if(++E>=D){D=null;if(F){F=null}if(g){g();g=null}}}};var q=function(){var I;if(typeof arguments[0]=="string"){I={tag:arguments[0]};if(typeof arguments[1]=="string"){I.attributes=arguments[2]||{};I.attributes.src=arguments[1]}else{if(arguments[1].attributes){I.attributes=arguments[1].attributes;I.children=arguments[1].children}else{if(arguments[1].children){I.attributes={};I.children=arguments[1].children}else{I.attributes=arguments[1]||{}}}}}else{I=arguments[0]}var D={attributes:{}};if(true){var g=I.tag||"a-entity";var J="";var F=g.split("#");if(F.length>1){g=F[0];J=F[1]}D.tag=g;D.attributes.id=J}for(var H in I.attributes){D.attributes[H]=I.attributes[H]}if(I.children){var G=I.children;D.children=[];if(Array.isArray(G)){for(var E=0;E<G.length;E++){D.children.push(q(G[E]))}}else{for(var E in G){D.children.push(q(E,G[E]))}}}return D};var k=function(D){var G=document.createElement("div");G.innerHTML=(D||"").replace(/\n/g,"").replace(/\s+/g," ").replace(/^\s*/,"").replace(/\s*$/,"").replace(/>\s*</g,"><");var E=function(M,N){var I={tag:M.localName};N.push(I);if(M.attributes.length>0){var H=I.attributes={};for(var J=0;J<M.attributes.length;J++){H[M.attributes[J].name]=M.attributes[J].value}}if(M.children.length>0){var L=I.children=[];for(var K=0;K<M.children.length;K++){E(M.children[K],L)}}};var F=[];try{E(G,F)}catch(g){console.log("err html",g)}return(F[0]&&F[0].children)||[]};var a=function(){var g=q.apply(q,arguments);return this.createAnEntity(g,this)};var z=function(G,D){if(!G){return}var F;if(Array.isArray(G)){for(var E=0;E<G.length;E++){F=this.createAnEntity(G[E],this);D&&D(F)}}else{if(typeof G=="string"){var H=k(G);z.bind(this)(H,D)}else{for(var g in G){F=this.addAnEntity(g,G[g]);D&&D(F)}}}};var x=function(F,E){if(typeof E=="undefined"){E=this}var F=q(F);var D=document.createElement(F.tag);if(E){E.appendChild(D)}u(D);r(D,F.attributes);if(F.children){for(var g=0;g<F.children.length;g++){this.createAnEntity(F.children[g],D)}}return D};var e=function(D){var g=AFRAME.$(D);g.parentNode.removeChild(g)};var d=function(E){var D=$$(E);for(var g=0;g<D.length;g++){D[g].parentNode&&D[g].parentNode.removeChild(D[g])}};var s=function(){this.onRemove&&this.onRemove();delete this.onRemove;this.parentNode&&this.parentNode.removeChild(this)};var r=function(E,g){if(typeof g=="function"){g=g()}if(g){for(var D in g){E.setAttribute(D,g[D]||"")}}};var j=function(g){Object.defineProperty(g.obj,g.key,{get:g.get,set:g.set,})};var c=function(D,g){j({obj:D,key:"x",get:function(){return g.x},set:function(E){return g.x=E},});j({obj:D,key:"y",get:function(){return g.y},set:function(E){return g.y=E},});j({obj:D,key:"z",get:function(){return g.z},set:function(E){return g.z=E},})};var p=AFRAME.addQuickAttributes=function(g){if(typeof g.visible=="undefined"){j({obj:g,key:"visible",get:function(){return g.getAttribute("visible")},set:function(D){return g.setAttribute("visible",D)},})}if(g.object3D&&g.object3D.position){g.position={};c(g.position,g.object3D.position)}if(g.object3D&&g.object3D.rotation){g.rotation={};c(g.rotation,g.object3D.rotation)}if(g.object3D&&g.object3D.scale){g.scale={};c(g.scale,g.object3D.scale)}};var b=function(E){if(!E||!E.conf){return}if(!this.hasLoaded){return this.addEventListener("loaded",function(){b.bind(this)(E)})}var D=this.sceneEl&&this.sceneEl.systems["afbcAnim"];if(!D){return setTimeout(function(){b.bind(this)(E)},100)}var g=Date.now()+Math.round(10000*Math.random());var F=E.conf;F["currRepeat"+g]=0;AnimRealRun.bind(this)(F,null,g)};var o=function(){if(!this.hasLoaded){return this.addEventListener("loaded",function(){o.bind(this)()})}var g=this.sceneEl&&this.sceneEl.systems["afbcAnim"];if(!g){return setTimeout(function(){o.bind(this)()},100)}g.pause(this)};var l=function(){if(!this.hasLoaded){return this.addEventListener("loaded",function(){l.bind(this)()})}var g=this.sceneEl&&this.sceneEl.systems["afbcAnim"];if(!g){return setTimeout(function(){l.bind(this)()},100)}g.resume(this)};var u=function(g){g.addAnEntity=a.bind(g);g.addEntities=z.bind(g);g.createAnEntity=x.bind(g);g.removeAnEntity=e.bind(g);g.removeEntities=d.bind(g);g.removeMe=s.bind(g);g.setAttributes=function(D){r(g,D)};p(g);g.animRun=b.bind(g);g.animPause=o.bind(g);g.animResume=l.bind(g);return g};AFRAME.extScenes={};AFRAME.extCurrScene=null;AFRAME.createAScene=function(g){AFRAME.extScenes[g.id]=g;return this};AFRAME.loadScene=function(g){if(this.extCurrScene){this.extCurrScene.removeMe()}var E=document.createElement("a-scene");u(E);var G=this.extScenes[g];if(!G){return console.error("No scene: "+g)}document.body.appendChild(E);if(G.onRemove){E.onRemove=G.onRemove.bind(G)}this.extCurrScene=E;var D=G.attributes||{};if(typeof D=="function"){D=D()}D.id=g;r(E,D);E.addAnEntity("a-assets",{id:"assets"});E.assets=new h("#assets");var F=G.assets||{};if(typeof F=="function"){F=F()}E.assets.addList(F);E.addEntities(G.children);if(G.onInit){G.onInit.bind(G)(E)}E.assets.load(function(){var H=function(){G.onLoaded&&G.onLoaded.bind(G)(E)}.bind(this);if(E.hasLoaded){H()}else{E.addEventListener("loaded",H)}},G.onLoading&&G.onLoading.bind(G))};var t=function(D,g,F){if(!F){return}var E=function(){D.removeEventListener(D._eventName,E);delete D._eventName;var G=F;F=null;G()};if(g=="script"){return D.onload=function(){delete D.onload;var G=F;F=null;G()}}if(g=="img"){D._eventName="load"}else{if(g=="audio"||g=="video"){D._eventName="loadeddata"}else{D._eventName="loaded"}}D.addEventListener(D._eventName,E)};var h=function(g){this.id=g;this.list={}};h.prototype.add=function(){var F=q.apply(q,arguments);if(!F.attributes.crossorigin){F.attributes.crossorigin="anonymous"}var g=F.tag;var D=$(this.id);var E=D.addAnEntity(F);this.list[g]=E;return this};h.prototype.addList=function(E){if(!E){return}if(Array.isArray(E)){for(var D=0;D<E.length;D++){this.add(E[D])}}else{for(var g in E){this.add(g,E[g])}}return this};h.prototype.load=function(D,I){var H=this.list;this.list={};var E=0;for(var G in H){E++}if(E<1){return D&&D()}var F=C(E,function(){D&&D()},I);for(var g in H){t(H[g],g,F)}return this};AFRAME.registerComponent("f-click-to-scene",{schema:{scene:{type:"string"}},init:function(){this.el.addEventListener("click",this.loadScene.bind(this))},loadScene:function(){AFRAME.loadScene(this.data.scene)},remove:function(){this.el.removeEventListener("click",this.loadScene.bind(this))}});document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,false);var g=document.body.getAttribute("scene");if(g){AFRAME.loadScene(g)}},false);AFRAME.registerSystem("afbcAnim",{init:function(){this.list=[]},addAnim:function(g,D,E){this.list.push({idx:g,anim:D,target:E})},removeAnim:function(g){for(var D=0;D<this.list.length;D++){if(this.list[D].idx==g){this.list.splice(D,1)}}},removeAnimByTarget:function(g){for(i=this.list.length-1;i>-1;i--){if(this.list[i].target==g){this.list.splice(i,1)}}},pause:function(g){g.isAnimPause=true;for(i=this.list.length-1;i>-1;i--){if(this.list[i].target==g){this.list[i].anim.pause()}}},resume:function(g){g.isAnimPause=false;for(i=this.list.length-1;i>-1;i--){if(this.list[i].target==g){this.list[i].anim.play()}}},tick:(function(){var g;return function(D){if(this.list.length){for(g=this.list.length-1;g>-1;g--){if(this.list[g].target.isAnimPause){return}this.list[g].anim.tick(D)}}}})(),});var A=function(){this.conf=null};AFRAME.anim=function(){return new A()};var B=function(g){if(Math.abs(g.x)<Number.EPSILON){g.x=0}if(Math.abs(g.y)<Number.EPSILON){g.y=0}if(Math.abs(g.z)<Number.EPSILON){g.z=0}};AnimRealRun=function(J,F,K){if(J._repeat>-1&&J["currRepeat"+K]>=J._repeat){delete J["currRepeat"+K];delete J["_from"+K];delete J["_to"+K];return F&&F()}var I=AnimRealRun.bind(this);var g=this.sceneEl.systems["afbcAnim"];J["currRepeat"+K]++;switch(J.type){case"sequence":if(typeof J["sequenceIdx"+K]=="undefined"){J["sequenceIdx"+K]=0}var H=J._sequence[J["sequenceIdx"+K]];J["sequenceIdx"+K]++;if(H){J["currRepeat"+K]--;H["currRepeat"+K]=0;I(H,function(){I(J,F,K)},K)}else{J["sequenceIdx"+K]=0;I(J,F,K)}break;case"spawn":if(J._spawn.length<1){return I(J,F,K)}var O=C(J._spawn.length,function(){I(J,F,K)});for(var G=0;G<J._spawn.length;G++){J._spawn[G]["currRepeat"+K]=0;I(J._spawn[G],O,K)}break;case"cb":J.cb&&J.cb.bind(J.taget)();I(J,F,K);break;case"delay":setTimeout(function(){I(J,F,K)},J._delay);break;case"fadeOut":case"fadeIn":case"fadeTo":var N=Date.now()+Math.round(10000*Math.random());var D=J.getConfig();var E=(this.object3DMap&&this.object3DMap.mesh&&this.object3DMap.mesh.material)||(this.components&&this.components.material&&this.components.material.material);if(!E){return F&&F()}if(Array.isArray(E)){E.forEach(function(Q){Q.transparent=true})}else{E.transparent=true}var M,L;if(J._reverse&&J["currRepeat"+K]%2==0){L=J["_from"+K];M=J["_to"+K]}else{M=J.from;L=J.to;if(typeof M=="undefined"){M=Array.isArray(E)?E[0].opacity:E.opacity}}D.opacity=[M,L];J["_from"+K]=M;J["_to"+K]=L;D.targets=E;D.complete=function(){g.removeAnim(N);I(J,F,K)};g.addAnim(N,AFRAME.ANIME(D),this);break;case"move":case"moveTo":case"moveBy":var N=Date.now()+Math.round(10000*Math.random());var D=J.getConfig();var P=this.object3D&&this.object3D.position;if(!P){return F&&F()}var M,L;if(J._reverse&&J["currRepeat"+K]%2==0){L=J["_from"+K];M=J["_to"+K]}else{M=J.from&&new THREE.Vector3().copy(J.from);L=J.to&&new THREE.Vector3().copy(J.to);if(!M){M=new THREE.Vector3().copy(P)}if(!L){L=new THREE.Vector3().copy(P).add(J.by)}}B(M);B(L);D.x=[M.x,L.x];D.y=[M.y,L.y];D.z=[M.z,L.z];J["_from"+K]=M;J["_to"+K]=L;D.targets=P;D.complete=function(){g.removeAnim(N);I(J,F,K)};g.addAnim(N,AFRAME.ANIME(D),this);break;case"scale":case"scaleTo":case"scaleBy":var N=Date.now()+Math.round(10000*Math.random());var D=J.getConfig();var P=this.object3D&&this.object3D.scale;if(!P){return F&&F()}var M,L;if(J._reverse&&J["currRepeat"+K]%2==0){L=J["_from"+K];M=J["_to"+K]}else{M=J.from&&new THREE.Vector3().copy(J.from);L=J.to&&new THREE.Vector3().copy(J.to);if(!M){M=new THREE.Vector3().copy(P)}if(!L){L=new THREE.Vector3().copy(P).add(J.by)}}B(M);B(L);D.x=[M.x,L.x];D.y=[M.y,L.y];D.z=[M.z,L.z];J["_from"+K]=M;J["_to"+K]=L;D.targets=P;D.complete=function(){g.removeAnim(N);I(J,F,K)};g.addAnim(N,AFRAME.ANIME(D),this);break;case"rotation":case"rotationTo":case"rotationBy":var N=Date.now()+Math.round(10000*Math.random());var D=J.getConfig();var P=this.object3D&&this.object3D.rotation;if(!P){return F&&F()}var M,L;if(J._reverse&&J["currRepeat"+K]%2==0){L=J["_from"+K];M=J["_to"+K]}else{M=J.from&&new THREE.Vector3().copy(J.from);L=J.to&&new THREE.Vector3().copy(J.to);if(!M){M=new THREE.Vector3().copy(P)}if(!L){L=new THREE.Vector3().copy(P).add(J.by)}}B(M);B(L);D.x=[M.x,L.x];D.y=[M.y,L.y];D.z=[M.z,L.z];J["_from"+K]=M;J["_to"+K]=L;D.targets=P;D.complete=function(){g.removeAnim(N);I(J,F,K)};g.addAnim(N,AFRAME.ANIME(D),this);break;case"color":case"colorTo":case"colorBy":var N=Date.now()+Math.round(10000*Math.random());var D=J.getConfig();var E=(this.object3DMap&&this.object3DMap.mesh&&this.object3DMap.mesh.material)||(this.components&&this.components.material&&this.components.material.material);if(!E){return F&&F()}var P=[];if(Array.isArray(E)){E.forEach(function(Q){P.push(Q.color)})}else{P.push(E.color)}var M,L;if(J._reverse&&J["currRepeat"+K]%2==0){L=J["_from"+K];M=J["_to"+K]}else{M=J.from&&new THREE.Color().copy(J.from);L=J.to&&new THREE.Color().copy(J.to);if(!M){M=new THREE.Color().copy(P[0])}if(!L){L=new THREE.Color().copy(P[0]).add(J.by)}}D.r=[M.r,L.r];D.g=[M.g,L.g];D.b=[M.b,L.b];J["_from"+K]=M;J["_to"+K]=L;D.targets=P;D.complete=function(){g.removeAnim(N);I(J,F,K)};g.addAnim(N,AFRAME.ANIME(D),this);break}};A.prototype.fadeOut=function(g){return this.conf=new m().setDuration(g).setFrom(1).setTo(0).setType("fadeOut")};A.prototype.fadeIn=function(g){return this.conf=new m().setDuration(g).setFrom(0).setTo(1).setType("fadeIn")};A.prototype.fadeTo=function(D,g){return this.conf=new m().setDuration(D).setTo(g).setType("fadeTo")};A.prototype.move=function(g,E,D){return this.conf=new m().setDuration(g).setFrom(E).setTo(D).setType("move")};A.prototype.moveTo=function(g,D){return this.conf=new m().setDuration(g).setTo(D).setType("moveTo")};A.prototype.moveBy=function(g,D){return this.conf=new m().setDuration(g).setBy(D).setType("moveBy")};A.prototype.scale=function(g,E,D){return this.conf=new m().setDuration(g).setFrom(E).setTo(D).setType("scale")};A.prototype.scaleTo=function(g,D){return this.conf=new m().setDuration(g).setTo(D).setType("scaleTo")};A.prototype.scaleBy=function(g,D){return this.conf=new m().setDuration(g).setBy(D).setType("scaleBy")};var n=Math.PI/180;A.prototype.rotation=function(g,E,D){E={x:E.x*n,y:E.y*n,z:E.z*n};D={x:D.x*n,y:D.y*n,z:D.z*n};return this.conf=new m().setDuration(g).setFrom(E).setTo(D).setType("rotation")};A.prototype.rotationTo=function(g,D){D={x:D.x*n,y:D.y*n,z:D.z*n};return this.conf=new m().setDuration(g).setTo(D).setType("rotationTo")};A.prototype.rotationBy=function(g,D){D={x:D.x*n,y:D.y*n,z:D.z*n};return this.conf=new m().setDuration(g).setBy(D).setType("rotationBy")};var f=function(g){if(typeof g!="object"){return new THREE.Color(g)}return{r:g.r/255,g:g.g/255,b:g.b/255}};A.prototype.color=function(g,E,D){E=f(E);D=f(D);return this.conf=new m().setDuration(g).setFrom(E).setTo(D).setType("color")};A.prototype.colorTo=function(g,D){D=f(D);return this.conf=new m().setDuration(g).setTo(D).setType("colorTo")};A.prototype.colorBy=function(g,D){D=f(D);return this.conf=new m().setDuration(g).setBy(D).setType("colorBy")};A.prototype.cb=function(g,D){return this.conf=new m().setCb(g,D).setType("cb")};A.prototype.delay=function(g){return this.conf=new m().delay(g).setType("delay")};A.prototype.sequence=function(){return this.conf=new m().sequence(arguments).setType("sequence")};A.prototype.spawn=function(){return this.conf=new m().spawn(arguments).setType("spawn")};var m=function(){this._repeat=1};m.prototype.getConfig=function(){var g={autoplay:false,direction:"normal",duration:1000,easing:"linear",elasticity:400,loop:0,round:false,};for(var D in g){if(typeof this["_"+D]!="undefined"){g[D]=this["_"+D]}}return g};m.prototype.setType=function(g){this.type=g;return this};m.prototype.setDuration=function(g){this._duration=parseInt(g);return this};m.prototype.setFrom=function(g){this.from=g;return this};m.prototype.setTo=function(g){this.to=g;return this};m.prototype.setBy=function(g){this.by=g;return this};m.prototype.setCb=function(g,D){this.cb=g;this.taget=D;return this};m.prototype.delay=function(g){this._delay=g;return this};m.prototype.reverse=function(g){this._reverse=true;return this};m.prototype.sequence=function(E){var g=this._sequence=[];for(var D=0;D<E.length;D++){g.push(E[D])}return this};m.prototype.spawn=function(E){var g=this._spawn=[];for(var D=0;D<E.length;D++){g.push(E[D])}return this};m.prototype.repeat=function(g){this._repeat=g;return this};m.prototype.repeatForever=function(){this._repeat=-1;return this};["linear","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","easeOutSine","easeInOutSine","easeInExpo","easeOutExpo","easeInOutExpo","easeInCirc","easeOutCirc","easeInOutCirc","easeInBack","easeOutBack","easeInOutBack","easeInElastic","easeOutElastic","easeInOutElastic"].forEach(function(g){m.prototype[g]=function(){this._easing=g;return this}});var y=function(){this.events={};this.targets=[]};y.prototype.onAny=function(G,E,F){if(!G){return this}var g=this.targets;for(var D=0;D<g.length;D++){if(G==g[D]){return this}}g.push({listener:G,pri:parseInt(E||0),once:F||-1});g.sort(function(I,H){return I.pri-H.pri});return this};y.prototype.offAny=function(E){if(!E){return this}var g=this.targets;for(var D=0;D<g.length;D++){if(E==g[D].listener){g.splice(D,1);return this}}return this};y.prototype.on=function(g,G,D,E){if(!g){return this}var F=g.slice(0,1);if(F!=F.toUpperCase()){throw"[First char of the string must be upper case]"}if(typeof G!="function"){if(!G||!(G["on"+g]||G["onAnyEvent"])){throw"[No on"+g+" or onAnyEvent handler of the listener]"}}if(!this.events[g]){this.events[g]=[]}var H=this.events[g];H.push({listener:G,pri:parseInt(D||0),once:E||-1});H.sort(function(J,I){return J.pri-I.pri});return this};y.prototype.ons=function(H,G,E,F){if(Array.isArray(H)){for(var D=0,g=H.length;D<g;D++){this.on(H[D],G,E,F)}}return this};y.prototype.off=function(D,F){var G=this.events[D];if(G){for(var E=0,g=G.length;E<g;E++){if(G[E].listener==F){G.splice(E,1);return this}}}return this};y.prototype.offAll=function(g){if(this.events[g]){delete this.events[g]}return this};y.prototype.emit=function(E){var J=E.name;var D=this.events[J];var I,G,F,g;var L=[];if(D){for(var H=D.length-1;H>=0;H--){I=D[H];G="on"+J;F=I.listener;if(typeof F!="function"){if(!F[G]){G="onAnyEvent"}g=F[G]&&F[G](E);L.push(F)}else{g=F(E)}if(--I.once==0){D.splice(H,1)}if(g===true){return}}}var K=this.targets;for(var H=0;H<K.length;H++){I=K[H];if(L.indexOf(I)>=0){continue}G="on"+J;F=I.listener;if(!F[G]){G="onAnyEvent"}g=F[G]&&F[G](E);if(--I.once==0){K.splice(H,1)}if(g===true){return}}};AFRAME.EMC=y;AFRAME.EM=new y();var w=function(G,E,D){E=E||"init";D=D||"remove";var F;if(G[E]){F=G[E]}G[E]=function(){this.EM=AFRAME.EM;this.myEventList=[];F&&F.apply(this,arguments)};var g;if(G[D]){g=G[D]}G[D]=function(){this.removeAllEvent();g&&g.apply(this,arguments)};G.removeAllEvent=function(){var J;for(var I=0,H=this.myEventList.length;I<H;I++){J=this.myEventList[I];this.EM.off(J.eventName,J.target)}this.myEventList.length=0;this.EM.offAny(this)};G.on=function(I,M,L){M=M||this;var K;for(var J=0,H=this.myEventList.length;J<H;J++){K=this.myEventList[J];if(K.target==M&&K.eventName==I){return this}}this.myEventList.push({target:M,eventName:I});this.EM.on(I,M,L);return this};G.ons=function(L,K,J){if(arguments.length>0){var H;if(!Array.isArray(L)){L=arguments;J=arguments[arguments.length-1];if(typeof J=="number"){K=arguments[arguments.length-2];if(typeof K=="object"){H=arguments.length-2}else{K=null;H=arguments.length-1}}else{if(typeof J=="object"){H=arguments.length-1;K=J;J=0}else{H=arguments.length;J=0;K=null}}}else{H=L.length;if(typeof K=="number"){J=K;K=null}}for(var I=0;I<H;I++){this.on(L[I],K,J)}}return this};G.off=function(I,L){L=L||this;var K;for(var J=0,H=this.myEventList.length;J<H;J++){K=this.myEventList[J];if(K.target==L&&K.eventName==I){this.EM.off(I,L);this.myEventList.splice(J,1);return this}}return this};G.offs=function(K,J){for(var I=0,H=K.length;I<H;I++){this.off(K[I],J)}return this};G.onAny=function(H,I){this.EM.onAny(this,H,I)};G.offAny=function(){this.EM.offAny(this)};G.emit=function(K,L,J,I,H){if(typeof K=="string"){this.EM.emit({name:K,data:L},J,I,H)}else{this.EM.emit(K,L,J)}};return G};["registerComponent","registerGeometry","registerSystem","registerShader","registerPrimitive"].forEach(function(g){var D=AFRAME[g].bind(AFRAME);AFRAME[g]=function(E,F){return D(E,w(F))}});["createAScene"].forEach(function(g){var D=AFRAME[g].bind(AFRAME);AFRAME[g]=function(E){return D(w(E,"onInit","onRemove"))}})})(window);